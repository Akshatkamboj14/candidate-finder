<!doctype html>
<html>

<head>
    <meta charset="utf-8" />
    <title>JD → Candidates (Phase 1)</title>
</head>

<body>
    <h2>Paste Job Description</h2>
    <textarea id="jd" rows="10" cols="80">Senior Backend Engineer, Python, AWS, microservices</textarea><br />
    <label>Max results: <input id="k" type="number" value="10" /></label>
    <button id="find">Find Matches</button>


    <h3>Results</h3>
    <div id="results"></div>


    <h3>Upload Resume (PDF)</h3>
    <input type="file" id="file" accept="application/pdf" />
    <button id="upload">Upload</button>


    <script>
        document.getElementById('find').onclick = async () => {
            const jd = document.getElementById('jd').value;
            const k = Number(document.getElementById('k').value || 10);
            const res = await fetch(`${API_BASE}/api/job`, {
		  method: 'POST',
		  headers: { 'content-type': 'application/json' },
		  body: JSON.stringify({ jd, k })
		});
            const data = await res.json();
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '';
            for (const r of data.results) {
                const el = document.createElement('div');
                el.innerHTML = `<b>${r.id}</b> — score: ${r.score.toFixed(4)}<pre>${r.document.slice(0, 300)}</pre>`;
                resultsDiv.appendChild(el);
            }
        }


        document.getElementById('upload').onclick = async () => {
            const f = document.getElementById('file').files[0];
            const fd = new FormData();
            fd.append('file', f);

	    const res = await fetch(`${API_BASE}/api/upload`, { method: 'POST', body: fd });

            const data = await res.json();
            alert('Uploaded: ' + JSON.stringify(data));
        }
    </script>
</body>

</html>
